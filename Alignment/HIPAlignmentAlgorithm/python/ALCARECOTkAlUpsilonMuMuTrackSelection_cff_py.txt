import Alignment.CommonAlignment.tools.trackselectionRefitting as TrackRefitterSequencer

if "momconstr" in strflaglower:
  process.load("RecoTracker.TrackProducer.TwoBodyDecayMomConstraintProducer_cff")
  process.TwoBodyDecayMomConstraint.src = "AlignmentTrackSelector"
  process.TwoBodyDecayMomConstraint.primaryMass = cms.double(9.46)
  process.TwoBodyDecayMomConstraint.primaryWidth = cms.double(0.05)
  #process.TwoBodyDecayMomConstraint.sigmaPositionCut = cms.double(0.07)
  process.TwoBodyDecayMomConstraint.rescaleError = cms.double(1.0)
  process.TwoBodyDecayMomConstraint.chi2Cut = cms.double(99999.)
  #process.TwoBodyDecayMomConstraint.EstimatorParameters.RobustificationConstant = cms.double(1.0)

  process.TrackRefitterSequence = TrackRefitterSequencer.getSequence(
    process,
    "ALCARECOTkAlUpsilonMuMu",
    TTRHBuilder = "WithAngleAndTemplate",
    usePixelQualityFlag = None, # Keep default behavior ("WithAngleAndTemplate" -> True, "WithTrackAngle" -> False)
    openMassWindow = False,
    cosmicsDecoMode = False,
    cosmicsZeroTesla = False,
    momentumConstraint = "TwoBodyDecayMomConstraint,momentum", # Should be a momentum constraint object
    cosmicTrackSplitting = False,
    use_d0cut = True
    )

elif "full" in strflaglower:
  process.load("RecoTracker.TrackProducer.TwoBodyDecayConstraintProducer_cff")
  process.TwoBodyDecayConstraint.src = "AlignmentTrackSelector"
  process.TwoBodyDecayConstraint.primaryMass = cms.double(9.46)
  process.TwoBodyDecayConstraint.primaryWidth = cms.double(0.05)
  #process.TwoBodyDecayConstraint.sigmaPositionCut = cms.double(0.07)
  process.TwoBodyDecayConstraint.rescaleError = cms.double(1.0)
  process.TwoBodyDecayConstraint.chi2Cut = cms.double(99999.)
  #process.TwoBodyDecayConstraint.EstimatorParameters.RobustificationConstant = cms.double(1.0)

  process.TrackRefitterSequence = TrackRefitterSequencer.getSequence(
    process,
    "ALCARECOTkAlUpsilonMuMu",
    TTRHBuilder = "WithAngleAndTemplate",
    usePixelQualityFlag = None, # Keep default behavior ("WithAngleAndTemplate" -> True, "WithTrackAngle" -> False)
    openMassWindow = False,
    cosmicsDecoMode = False,
    cosmicsZeroTesla = False,
    momentumConstraint = "TwoBodyDecayConstraint,trackParameters", # Should be a momentum constraint object
    cosmicTrackSplitting = False,
    use_d0cut = True
    )

else:
  process.TrackRefitterSequence = TrackRefitterSequencer.getSequence(
    process,
    "ALCARECOTkAlUpsilonMuMu",
    TTRHBuilder = "WithAngleAndTemplate",
    usePixelQualityFlag = None, # Keep default behavior ("WithAngleAndTemplate" -> True, "WithTrackAngle" -> False)
    openMassWindow = False,
    cosmicsDecoMode = False,
    cosmicsZeroTesla = False,
    momentumConstraint = None, # Should be a momentum constraint object
    cosmicTrackSplitting = False,
    use_d0cut = True
    )

# Override TrackRefitterSequencer defaults
process.AlignmentTrackSelector.pMin    = 0.0
process.AlignmentTrackSelector.ptMin   = 4.0
process.AlignmentTrackSelector.etaMin  = -2.5
process.AlignmentTrackSelector.etaMax  = 2.5
process.AlignmentTrackSelector.nHitMin = 4
process.AlignmentTrackSelector.TwoBodyDecaySelector.daughterMass = 0.105658
process.AlignmentTrackSelector.TwoBodyDecaySelector.minXMass = 9.2
process.AlignmentTrackSelector.TwoBodyDecaySelector.maxXMass = 9.65
